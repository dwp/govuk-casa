include:
  - project: dwp/engineering/pipeline-solutions/gitlab/functions
    ref: 4.17.4
    file:
      - functions/node.yml
      - functions/auto-tag-merge.yml

variables:
  NODE_IMAGE: node:10.18.1-alpine@sha256:60f531bebdb8023a1ecdcbb4ea5658eb499c1c71b4255ccbddf2d0277c947f93
  NODE_PUBLISH_TO_GITLAB: "true"
  NODE_PUBLISH_TO_NPMJS: "true"
  AUTO_TAG_MERGE_PREPARE_MR: "true"
  AUTO_TAG_MERGE_TAG_BRANCH: "maintain/5.x"

# ------------------------------------------------------------------ custom jobs

# Manipulate publishing process to Gitlab
node-publish-gitlab:
  variables:
    NPM_PUBLISH_TAG: "maintain5x"
  before_script:
    # Need to install a slightly newer npm version in order to support the
    # `--location` cli option (min v7), which is used in the
    # `.node-publish-package-template` job template.
    - npm i -g npm@7.24.2

# Use a version-specific branch name for auto-packaging
auto-tag-merge-prepare-mr:
  variables:
    MR_BRANCH: chore/auto-package-v5
